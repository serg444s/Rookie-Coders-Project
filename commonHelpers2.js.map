{"version":3,"file":"commonHelpers2.js","sources":["../src/img/shopping_list/trash.png","../src/js/shop_list.js"],"sourcesContent":["export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADjSURBVHgBnVKBDYIwEPwaB8AJ7AhsIBsYNmADGcERdALZwBXYQDYAJoAN6hWrvu0jDZdcvmmv1/7lFQkwxhQo2tvulFIVxQAGrQnRSlqFgwQ1pRXAj2r7WmnWo1TuyxnKHazB68LDJXgAc7Ah1ncH3hYuW13F89iwswHcOZEGHzYfvna6PdhLBiP4Fml6BZt66wDcoHfuS0jcY4FBLGybg2TQ0Xf6RrY/egY/GWxJAAakQWj5NCg0hfpZz8LOvxsO/UeTOk1BMy1YnGYu2/COnjYQnSPG98LvKMEkQ8lIRu1n8QSBQeOQY05IhwAAAABJRU5ErkJggg==\"","import { loaderOn, loaderOff } from './loader';\nimport axios from 'axios';\nimport { onLoad } from '../js/dark-mode.js';\nimport { onOpenModal, onCloseModal } from '../js/burger.js';\nimport amazon1x from '../img/shopping_list/amazon1x.png';\nimport amazon2x from '../img/shopping_list/amazon2x.png';\nimport openbook from '../img/shopping_list/openbook.png';\nimport trash from '../img/shopping_list/trash.png';\nimport Pagination from 'tui-pagination';\nimport { onError } from './iziToasts.js';\nconst openModalBtn = document.querySelector('[data-action=\"open-modal\"]');\nconst closeModalBtn = document.querySelector('[data-action=\"close-modal\"]');\nopenModalBtn.addEventListener('click', onOpenModal);\ncloseModalBtn.addEventListener('click', onCloseModal);\n//функція Анатолія для отримання книги за id (поки тут, але потім її треба буде просто імпортувати)\nasync function getBookById(bookId) {\n  const resp = await axios.get(\n    `https://books-backend.p.goit.global/books/${bookId}`\n  );\n  return resp.data;\n}\n\nconst booksContainer = document.querySelector('.js-books-container');\nconst emptyListImg = document.querySelector('.empty-shopping-list-main');\nconst shoppingListLoader = document.querySelector('#shopping-list-loader');\nconst tuiPagination = document.getElementById('pagination2');\nlet savedBooks; //масив книжок отриманих з бекенду\nlet itemsPerPage = calculateItemsPerPage(); //одразу перевіряємо розмір екрану і визначаємо кількість карток на сторінці\n\nonLoad();\nstartFunction();\ngetAllBooks();\n\nfunction startFunction() {\n  booksContainer.innerHTML = '';\n  emptyListImg.style.display = 'none';\n  loaderOn(shoppingListLoader);\n}\n\nwindow.addEventListener('resize', () => {\n  if (savedBooks.length !== 0) {\n    itemsPerPage = calculateItemsPerPage();\n    const pagination2 = new Pagination(tuiPagination, {\n      totalItems: savedBooks.length,\n      itemsPerPage: itemsPerPage,\n      visiblePages: 3,\n      centerAlign: true,\n    });\n    renderBooks(1);\n  }\n});\n\nfunction waitForEvent(element, eventType) {\n  return new Promise(function (resolve, reject) {\n    function eventHandler(event) {\n      // Після виконання події видаляємо обробник події\n      element.removeEventListener(eventType, eventHandler);\n      // Вирішуємо проміс з даними, які вас цікавлять\n      resolve(event);\n    }\n    // Додаємо обробник події\n    // element.addEventListener(eventType, eventHandler);\n    element.addEventListener(eventType, event => {\n      if (\n        event.target.classList.contains('tui-page-btn') &&\n        !event.target.classList.contains('tui-is-selected') &&\n        !event.target.classList.contains('tui-is-disabled')\n      ) {\n        eventHandler();\n      }\n    });\n  });\n}\n\nfunction calculateItemsPerPage() {\n  const screenWidth = window.innerWidth;\n  return screenWidth < 768 ? 4 : 3;\n}\n\nfunction getAllBooks() {\n  addBooks()\n    .then(result => {\n      savedBooks = result;\n      if (savedBooks.length === 0) {\n        loaderOff(shoppingListLoader);\n        emptyListImg.style.display = 'block';\n        booksContainer.innerHTML = '';\n        tuiPagination.innerHTML = '';\n      } else {\n        loaderOff(shoppingListLoader);\n\n        const pagination2 = new Pagination(tuiPagination, {\n          totalItems: savedBooks.length,\n          itemsPerPage: itemsPerPage,\n          visiblePages: 3,\n          centerAlign: true,\n        });\n        renderBooks(1);\n      }\n    })\n    .catch(() => {\n      onError();\n    });\n}\n\nfunction renderBooks(pageNumber) {\n  const transitionalBooksArray = [...savedBooks];\n  let booksOnPage = transitionalBooksArray.splice(\n    itemsPerPage * (pageNumber - 1),\n    itemsPerPage\n  );\n  const booksMarkup = booksOnPage.map(book => createBookCard(book)).join('');\n  booksContainer.innerHTML = booksMarkup;\n  emptyListImg.style.display = 'none';\n\n  // Викликаємо функцію, що очікує подію 'click' і повертає проміс\n  waitForEvent(tuiPagination, 'click').then(function (event) {\n    // Цей код буде виконаний після того, як подія 'click' відбудеться\n    renderBooks(parseInt(document.getElementsByTagName('strong')[0].innerHTML));\n  });\n}\n\n//функція отримує масив id збережених у сховищі і повертає масив промісів на книги\nfunction addBooks() {\n  return new Promise((resolve, reject) => {\n    const savedInShopList = localStorage.getItem('books');\n\n    if (savedInShopList) {\n      const booksIdArray = JSON.parse(savedInShopList);\n      const promises = [];\n\n      booksIdArray.forEach(bookId => {\n        const promise = getBookById(bookId);\n        promises.push(promise);\n      });\n\n      Promise.all(promises)\n        .then(books => {\n          resolve(books);\n        })\n        .catch(error => {\n          reject(error);\n        });\n    } else {\n      resolve([]);\n    }\n  });\n}\n\n//функція повертає розмітку однієї картки\nfunction createBookCard(book) {\n  const { book_image, title, list_name, description, author, buy_links, _id } =\n    book; //деструктуризуємо\n  return `<div class=\"book-list\">\n<img class=\"book-card-img\" src=\"${book_image}\" alt=\"${title}\" />\n<div class=\"shop-card-info\">\n<div class=\"shop-card-hero\">\n<div class=\"shop-list-title-name\">\n<h3 class=\"shop-list-title\">${title}</h3>\n<p class=\"shop-list-list-name\">${list_name}</p>\n</div>\n<button class=\"remove-shop-list-book\" data-bookid=\"${_id}\">\n<img \n  class=\"icon-basket-shop-list\"\n  data-bookid=\"${_id}\"\n  src=\"${trash}\"\n  alt=\"Delete book\"\n  />\n</button>\n</div>\n<p class=\"shop-list-description\">${description}<p>\n<div class=\"shop-list-downpart\">\n<p class=\"shop-list-author\"> Author: ${author}</p>\n<div class=\"shop-list-links\">\n<a class=\"amazon-link\" target=\"_blank\" href=\"${\n    buy_links.find(buyLink => buyLink.name === 'Amazon').url\n  }\">\n<img \nclass=\"amazon-img  html.dark-mode & {}\"\nsrcset=\"\n${amazon1x} 1x,\n${amazon2x} 2x\n\"\nsrc=\"${amazon1x}\"\nalt=\"Amazon Shop\"\n/>\n</a>\n<a class=\"openbooks-link\" target=\"_blank\" href=\"${\n    buy_links.find(buyLink => buyLink.name === 'Apple Books').url\n  }\">\n     <img \n  class=\"open-book-icon\"\n  src=\"${openbook}\"\n  alt=\"Open book\"\n  />\n  </a>\n</div>\n</div>\n</div>\n</div>`;\n}\n\nfunction removeBook(event) {\n  if (\n    event.target.classList.contains('remove-shop-list-book') ||\n    event.target.classList.contains('icon-basket-shop-list') ||\n    event.target.dataset.name === 'remove-shop-list-book'\n  ) {\n    const bookId = event.target.getAttribute('data-bookid');\n    removeBookFromList(bookId);\n  }\n}\n\nfunction removeBookFromList(bookId) {\n  let savedInShopList = localStorage.getItem('books');\n\n  if (savedInShopList) {\n    savedInShopList = JSON.parse(savedInShopList);\n    const indexToRemove = savedInShopList.indexOf(bookId);\n\n    // Видаляємо книгу з масиву за її індексом\n    if (indexToRemove !== -1) {\n      savedInShopList.splice(indexToRemove, 1);\n    }\n\n    // Зберігаємо оновлений масив книг в localStorage\n    localStorage.setItem('books', JSON.stringify(savedInShopList));\n\n    // Оновлюємо список книг на сторінці\n    getAllBooks();\n  }\n}\n\n//поки закоментувала видалення книжок\ndocument.addEventListener('click', removeBook);\n\nfunction currentStyle() {\n  const home = document.querySelector('.navigation_link_shopping');\n  home.classList.add('active');\n}\ncurrentStyle();\n\n////книги в localStorage - тимчасова кнопка додавання книжок\n// const addButton = document.querySelector('.add-book');\n\n// addButton.addEventListener('click', e => {\n//   const booksIdArray = [\n//     '643282b1e85766588626a080',\n//     '643282b1e85766588626a0ba',\n//     '643282b1e85766588626a0dc',\n//     '643282b2e85766588626a0fc',\n//     '643282b2e85766588626a118',\n//     '643282b1e85766588626a085',\n//     '643282b1e85766588626a0b2',\n//   ];\n//   localStorage.setItem('books', JSON.stringify(booksIdArray));\n// });\n\n// це щоб подивитися як працює перемикач для пагінації. його треба буде створювати при рендері і задавати відповідні значення\n// const pagination2 = new Pagination(tuiPagination, {\n//   totalItems: 25,\n//   itemsPerPage: 3,\n//   visiblePages: 5,\n//   centerAlign: true,\n// });\n"],"names":["trash","openModalBtn","closeModalBtn","onOpenModal","onCloseModal","getBookById","bookId","axios","booksContainer","emptyListImg","shoppingListLoader","tuiPagination","savedBooks","itemsPerPage","calculateItemsPerPage","onLoad","startFunction","getAllBooks","loaderOn","Pagination","renderBooks","waitForEvent","element","eventType","resolve","reject","eventHandler","event","addBooks","result","loaderOff","onError","pageNumber","booksMarkup","book","createBookCard","savedInShopList","booksIdArray","promises","promise","books","error","book_image","title","list_name","description","author","buy_links","_id","buyLink","amazon1x","amazon2x","openbook","removeBook","removeBookFromList","indexToRemove","currentStyle"],"mappings":"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"}